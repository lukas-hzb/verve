{% extends "base.html" %}

{% block content %}
<style>
    /* Flashcard Specific Styles - With Animations */
    /* Flashcard Specific Styles - With Animations */
    .card-container {
        perspective: 1000px;
        width: 100%;
        max-width: 700px;
        height: 380px;
        margin: 0 auto var(--space-8) auto;
        position: relative;
    }

    /* Wrapper for swipe animations (separate from perspective) */
    .flashcard-wrapper {
        width: 100%;
        height: 100%;
        position: relative;
        transform-origin: bottom center;
        /* Pivot from bottom for better tilt */
    }

    .flashcard {
        width: 100%;
        height: 100%;
        position: relative;
        transform-style: preserve-3d;
        /* Bouncy flip animation */
        transition: transform 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        cursor: pointer;
    }

    .flashcard.flipped {
        transform: rotateY(180deg);
    }

    .flashcard-front,
    .flashcard-back {
        position: absolute;
        width: 100%;
        height: 100%;
        backface-visibility: hidden;
        border-radius: var(--radius-xl);
        background-color: var(--color-bg-surface);
        box-shadow: var(--shadow-card);
        display: flex;
        align-items: center;
        justify-content: center;
        padding: var(--space-8);
        text-align: center;
        font-size: var(--font-size-2xl);
        font-weight: 500;
        color: var(--color-text-main);
        border: 1px solid var(--color-border);
    }

    .flashcard-back {
        transform: rotateY(180deg);
        background-color: var(--color-bg-surface-hover);
        color: var(--color-text-main);
    }

    .flashcard-content {
        overflow-y: auto;
        max-height: 100%;
        width: 100%;
    }

    /* Smooth Swipe Animations with subtle Tilt */
    @keyframes tilt-out-right {
        0% {
            transform: translateX(0) rotate(0deg);
            opacity: 1;
        }

        100% {
            transform: translateX(15%) rotate(12deg);
            opacity: 0;
        }
    }

    @keyframes tilt-out-left {
        0% {
            transform: translateX(0) rotate(0deg);
            opacity: 1;
        }

        100% {
            transform: translateX(-15%) rotate(-12deg);
            opacity: 0;
        }
    }

    .animate-swipe-right {
        animation: tilt-out-right 0.35s ease-out forwards;
    }

    .animate-swipe-left {
        animation: tilt-out-left 0.35s ease-out forwards;
    }

    /* Load In Animation - Pure fade in, no movement */
    @keyframes load-in {
        0% {
            opacity: 0;
        }

        100% {
            opacity: 1;
        }
    }

    .load-in {
        animation: load-in 0.25s ease-out forwards;
    }

    /* Level Indicator */
    .card-level {
        position: absolute;
        top: var(--space-4);
        right: var(--space-4);
        padding: 4px 12px;
        border-radius: 20px;
        font-size: 12px;
        color: white;
        z-index: 10;
        font-weight: 600;
        box-shadow: var(--shadow-sm);
    }

    /* Original Level Colors (Variables for JS compatibility) */
    .card-container {
        --level-1: #ff6b6b;
        --level-2: #ffa07a;
        --level-3: #ffd700;
        --level-4: #98fb98;
        --level-5: #87cefa;
    }

    /* Custom Toggle Switch (Keep as is, but cleaner) */
    .switch {
        position: relative;
        display: inline-block;
        width: 44px;
        height: 24px;
        margin-right: var(--space-2);
    }

    .switch input {
        opacity: 0;
        width: 0;
        height: 0;
    }

    .slider {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: var(--color-border);
        transition: .3s;
        border-radius: 24px;
    }

    .slider:before {
        position: absolute;
        content: "";
        height: 18px;
        width: 18px;
        left: 3px;
        bottom: 3px;
        background-color: white;
        transition: .3s;
        border-radius: 50%;
    }

    input:checked+.slider {
        background-color: var(--color-primary);
    }

    input:checked+.slider:before {
        transform: translateX(20px);
    }
</style>

<div
    style="padding: 15px var(--space-6) var(--space-6) var(--space-6); max-width: 1400px; width: 100%; margin: 0 auto;">

    <!-- Secondary Header for Learning -->
    <div style="margin-bottom: var(--space-6);">
        <div class="card-header-secondary">
            <h1 class="card-header-secondary-title">{{ set_name.replace('_', ' ') | title }}</h1>
            <div class="button-group">
                <a href="{{ url_for('main.set_overview', set_id=set_id) }}" class="btn-secondary"
                    style="text-decoration: none;">
                    <span class="material-symbols-outlined">arrow_back</span> Back to Overview
                </a>
            </div>
        </div>
    </div>

    <!-- Controls Bar -->
    <div class="card-normal"
        style="display: flex; justify-content: space-between; align-items: center; padding: var(--space-4); margin-bottom: var(--space-4); flex-wrap: wrap; gap: var(--space-4);">
        <div style="display: flex; gap: var(--space-6);">
            <div style="display: flex; align-items: center;">
                <label class="switch">
                    <input type="checkbox" id="practice-mode-checkbox">
                    <span class="slider round"></span>
                </label>
                <span style="font-weight: 500; font-size: var(--font-size-base); margin-left: var(--space-2);">Practice Mode</span>
            </div>
            <div style="display: flex; align-items: center;">
                <label class="switch">
                    <input type="checkbox" id="wrong-answers-checkbox">
                    <span class="slider round"></span>
                </label>
                <span style="font-weight: 500; font-size: var(--font-size-base); margin-left: var(--space-2);">Wrong Only</span>
            </div>
        </div>
        <div class="button-group" style="gap: var(--space-2);">
            <button class="btn-secondary" id="shuffle-btn">
                <span class="material-symbols-outlined">shuffle</span> Shuffle
            </button>
            <button class="btn-secondary" id="back-btn" disabled>
                <span class="material-symbols-outlined">undo</span> Undo
            </button>
            <button class="btn-secondary" id="restart-btn" title="Restart Session">
                <span class="material-symbols-outlined">redo</span> Restart
            </button>
        </div>
    </div>

    <!-- Progress Bar -->
    <div style="margin-bottom: var(--space-4);">
        <div style="height: 8px; background-color: var(--color-bg-surface-hover); border-radius: 4px; overflow: hidden; display: flex; border: 1px solid var(--color-border);">
            <div id="progress-correct" style="width: 0%; background-color: var(--color-accent-4); transition: width 0.3s;"></div>
            <div id="progress-wrong" style="width: 0%; background-color: var(--color-accent-1); transition: width 0.3s;"></div>
            <div id="progress-remaining" style="width: 100%; background-color: transparent; transition: width 0.3s;"></div>
        </div>
        <div style="display: flex; justify-content: space-between; margin-top: 8px; font-size: 0.875rem; color: var(--color-text-secondary);">
            <span>Progress</span>
            <span id="progress-text">0 / 0</span>
        </div>
    </div>
</div>

    <!-- Flashcard Area -->
    <div class="card-container">
        <!-- Level Indicator (ID matches what flashcard.js expects) -->
        <div id="card-level" class="card-level" style="display: none;">Level 1</div>

        <div class="flashcard-wrapper" id="flashcard-wrapper">
            <div class="flashcard" id="flashcard">
                <div class="flashcard-front" id="card-front-container">
                    <div class="flashcard-content">
                        <p id="card-front">Loading...</p>
                    </div>
                </div>
                <div class="flashcard-back" id="card-back-container">
                    <div class="flashcard-content">
                        <p id="card-back"></p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Action Buttons -->
    <div style="display: flex; justify-content: center; gap: var(--space-4); margin-top: var(--space-4);">
        <button class="btn-primary" id="flip-btn" style="min-width: 180px;">
            Flip Card <span style="opacity: 0.7; font-weight: 400; font-size: 0.875rem;">(Space)</span>
        </button>

        <div id="feedback-btns" style="display: none; gap: var(--space-4);">
            <button class="btn-danger" id="not-known-btn" style="min-width: 140px;">
                <span class="material-symbols-outlined" style="font-size: 18px;">close</span> Didn't know <span
                    style="opacity: 0.7; font-weight: 400; font-size: 0.875rem;">(A)</span>
            </button>
            <button class="btn-success" id="known-btn" style="min-width: 140px;">
                <span class="material-symbols-outlined" style="font-size: 18px;">check</span> Knew it <span
                    style="opacity: 0.7; font-weight: 400; font-size: 0.875rem;">(D)</span>
            </button>
        </div>
    </div>

</div>

<!-- Logic Link -->
<script type="module">
    import { FlashcardManager } from "{{ url_for('static', filename='js/modules/flashcard.js') }}";

    document.addEventListener('DOMContentLoaded', () => {
        new FlashcardManager("{{ set_id }}");
    });
</script>
{% endblock %}